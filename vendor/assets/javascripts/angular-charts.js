angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout","$sce",function(a,b,c,d,e,f){function h(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;c<6;c++)b+=a[Math.round(15*Math.random())];return b}function i(a,b){var c=null;for(var d in a)if(angular.isElement(a[d])&&(c=angular.element(a[d]),c.hasClass(b)))return c;return c}function j(c,g,j){function v(){y(),w(),x();var a=z(u);a(),J()}function w(){if(!k.legend.display)return q=m,void(r=l);switch(k.legend.position){case"top":case"bottom":q=.75*m,r=l;break;case"left":case"right":q=m,r=.75*l}}function x(){var d=a.get("angularChartsTemplate_"+k.legend.position);g.html(d),b(g.contents())(c);var e=g.find("div");s=i(e,"ac-chart"),t=i(e,"ac-legend"),q-=i(e,"ac-title")[0].clientHeight}function y(){n=c.acData,u=c.acChart,o=n?n.series||[]:[],p=n?n.data||[]:[],c.acConfig&&angular.extend(k,c.acConfig)}function z(a){var b={pie:E,bar:B,line:C,area:D,point:F};return b[a]}function A(a,b){var c=b.domain();if(k.xAxisMaxTicks&&c.length>k.xAxisMaxTicks){var d=Math.ceil(c.length/k.xAxisMaxTicks);a.tickValues(c.filter(function(a,b){return b%d===0}))}}function B(){var a={top:0,right:20,bottom:30,left:40};r-=a.left+a.right,q-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,r],.1),d=d3.scale.linear().range([q,10]),e=d3.scale.ordinal().rangeRoundBands([0,r],.1),f=[0];p.forEach(function(a){a.nicedata=a.y.map(function(b,c){return f.push(b),{x:a.x,y:b,s:c,tooltip:angular.isArray(a.tooltip)?a.tooltip[c]:a.tooltip}})});var g=d3.max(p.map(function(a){return a.y.length}));c.yMaxData=g,b.domain(p.map(function(a){return a.x}));var h=.2*d3.max(f);d.domain([d3.min(f),d3.max(f)+h]),e.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var i=d3.svg.axis().scale(b).orient("bottom");A(i,b);var j=d3.svg.axis().scale(d).orient("left").ticks(10).tickFormat(d3.format("s")),l=d3.select(s[0]).append("svg").attr("width",r+a.left+a.right).attr("height",q+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").call(i),l.append("g").attr("class","y axis").call(j);var m=l.selectAll(".state").data(p).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+b(a.x)+",0)"}),n=m.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");n.attr("width",e.rangeBand()),n.attr("x",function(a,b){return e(b)}).attr("y",q).style("fill",function(a){return N(a.s)}).attr("height",0).transition().ease("cubic-in-out").duration(k.isAnimate?1e3:0).attr("y",function(a){return d(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(d(a.y)-d(0))}),n.on("mouseover",function(a){G({index:a.x,value:a.tooltip?a.tooltip:a.y,series:o[a.s]},d3.event),k.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){H(),k.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(a,d3.event)}).on("click",function(a){k.click.call(a,d3.event),c.$apply()}),k.labels&&m.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return e(b)}).attr("y",function(a){return q-Math.abs(d(a.y)-d(0))}).text(function(a){return a.y}),l.append("line").attr("x1",r).attr("y1",d(0)).attr("y2",d(0)).style("stroke","silver")}function C(){function w(a){return Math.round(b(a))+b.rangeBand()/2}var a={top:0,right:40,bottom:20,left:40};r-=a.left+a.right,q-=a.top+a.bottom;var b=d3.scale.ordinal().domain(p.map(function(a){return a.x})).rangeRoundBands([0,r]),d=d3.scale.linear().range([q,10]),e=d3.svg.axis().scale(b).orient("bottom");A(e,b);var f=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),g=d3.svg.line().interpolate(k.lineCurveType).x(function(a){return w(a.x)}).y(function(a){return d(a.y)}),h=[0],i=[];p.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(p.map(function(a){return a.y.length}));c.yMaxData=j,o.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=p.map(function(a){return a.y.map(function(b){return{x:a.x,y:b,tooltip:a.tooltip}})[b]||{x:p[b].x,y:0}}),i.push(c)});var l=d3.select(s[0]).append("svg").attr("width",r+a.left+a.right).attr("height",q+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),m=.2*d3.max(h);d.domain([d3.min(h),d3.max(h)+m]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").call(e),l.append("g").attr("class","y axis").call(f);var n=l.selectAll(".points").data(i).enter().append("g"),t=n.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return N(b)}).attr("d",function(a){return g(a.values)}).attr("stroke-width","2").attr("fill","none");if(i.length>0){var u=i[i.length-1].values;if(u.length>0){var v=t.node().getTotalLength()+w(u[u.length-1].x);t.attr("stroke-dasharray",v+" "+v).attr("stroke-dashoffset",v).transition().duration(k.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return g(a.values)})}}return angular.forEach(i,function(a,b){var e=l.selectAll(".circle").data(a.values).enter();e.append("circle").attr("cx",function(a){return w(a.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",N(i.indexOf(a))).style("stroke",N(i.indexOf(a))).on("mouseover",function(a){return function(b){G({index:b.x,value:b.tooltip?b.tooltip:b.y,series:a},d3.event),k.mouseover(b,d3.event),c.$apply()}}(a.series)).on("mouseleave",function(a){H(),k.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(d3.event)}).on("click",function(a){k.click(a,d3.event),c.$apply()}),k.labels&&e.append("text").attr("x",function(a){return w(a.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})}),"lineEnd"===k.lineLegend&&n.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(a){return"translate("+w(a.value.x)+","+d(a.value.y)+")"}).attr("x",3).text(function(a){return a.name}),i}function D(){function t(a){return Math.round(b(a))+b.rangeBand()/2}var a={top:0,right:40,bottom:20,left:40};r-=a.left+a.right,q-=a.top+a.bottom;var b=d3.scale.ordinal().domain(p.map(function(a){return a.x})).rangePoints([0,r]),d=d3.scale.linear().range([q,10]),e=d3.svg.axis().scale(b).orient("bottom");A(e,b);var f=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s"));d3.svg.line().interpolate(k.lineCurveType).x(function(a){return t(a.x)}).y(function(a){return d(a.y)});var g=[0],h=[];p.forEach(function(a){a.y.map(function(a){g.push(a)})});var i=d3.max(p.map(function(a){return a.y.length}));c.yMaxData=i,o.slice(0,i).forEach(function(a,b){var c={};c.series=a,c.values=p.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:p[b].x,y:0}}),h.push(c)});var j=d3.select(s[0]).append("svg").attr("width",r+a.left+a.right).attr("height",q+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),l=.2*d3.max(g);d.domain([d3.min(g),d3.max(g)+l]),j.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").call(e),j.append("g").attr("class","y axis").call(f);var m=j.selectAll(".points").data(h).enter().append("g"),n=d3.svg.area().interpolate("basis").x(function(a){return t(a.x)}).y0(function(){return d(0)}).y1(function(a){return d(0+a.y)});m.append("path").attr("class","area").attr("d",function(a){return n(a.values)}).style("fill",function(a,b){return N(b)}).style("opacity","0.7")}function E(){function j(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return f(b(a))}}var a=Math.min(r,q)/2,b=d3.select(s[0]).append("svg").attr("width",r).attr("height",q).append("g").attr("transform","translate("+r/2+","+q/2+")"),d=0;if(k.innerRadius){var e=k.innerRadius;e="string"==typeof e&&e.indexOf("%")>0?a*(.01*parseFloat(e)):Number(e),e>=0&&(d=e)}c.yMaxData=p.length;var f=d3.svg.arc().outerRadius(a-10).innerRadius(d);d3.svg.arc().outerRadius(a+5).innerRadius(0);var g=d3.layout.pie().sort(null).value(function(a){return a.y[0]}),h=b.selectAll(".arc").data(g(p)).enter().append("g"),i=!1;h.append("path").style("fill",function(a,b){return N(b)}).transition().ease("linear").duration(k.isAnimate?500:0).attrTween("d",j).attr("class","arc").each("end",function(){i||(i=!0,h.on("mouseover",function(a){G({value:a.data.tooltip?a.data.tooltip:a.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),k.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),H(),k.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(a,d3.event)}).on("click",function(a){k.click(a,d3.event),c.$apply()}))}),k.labels&&h.append("text").attr("transform",function(a){return"translate("+f.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})}function F(){function m(a){return Math.round(b(a))+b.rangeBand()/2}var a={top:0,right:40,bottom:20,left:40};r-=a.left-a.right,q-=a.top-a.bottom;var b=d3.scale.ordinal().domain(p.map(function(a){return a.x})).rangeRoundBands([0,r]),d=d3.scale.linear().range([q,10]),e=d3.svg.axis().scale(b).orient("bottom");A(e,b);var f=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),g=[0],h=[];p.forEach(function(a){a.y.map(function(a,b){g.push(a)})});var i=d3.max(p.map(function(a){return a.y.length}));c.yMaxPoints=i,o.slice(0,i).forEach(function(a,b){var c={};c.series=a,c.values=p.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:p[b].x,y:0}}),h.push(c)});var j=d3.select(s[0]).append("svg").attr("width",r+a.left+a.right).attr("height",q+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),l=.2*d3.max(g);d.domain([d3.min(g),d3.max(g)+l]),j.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").call(e),j.append("g").attr("class","y axis").call(f),j.selectAll(".points").data(h).enter().append("g"),angular.forEach(h,function(a,b){var e=j.selectAll(".circle").data(a.values).enter();e.append("circle").attr("cx",function(a){return m(a.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",N(h.indexOf(a))).style("stroke",N(h.indexOf(a))).on("mouseover",function(a){return function(b){G({index:b.x,value:b.tooltip?b.tooltip:b.y,series:a},d3.event),k.mouseover(b,d3.event),c.$apply()}}(a.series)).on("mouseleave",function(a){H(),k.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(d3.event)}).on("click",function(a){k.click(a,d3.event),c.$apply()}),k.labels&&e.append("text").attr("x",function(a){return m(a.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})})}function G(a,b){if(k.tooltips){a="function"==typeof k.tooltips?k.tooltips(a):a.value;var d=angular.element('<p class="ac-tooltip"></p>').html(a).css({left:b.pageX+20+"px",top:b.pageY-30+"px"});angular.element(document.querySelector(".ac-tooltip")).remove(),angular.element(document.body).append(d),c.$tooltip=d}}function H(){c.$tooltip&&c.$tooltip.remove()}function I(a){c.$tooltip&&c.$tooltip.css({left:a.pageX+20+"px",top:a.pageY-30+"px"})}function J(){c.legends=[],"pie"===u&&angular.forEach(p,function(a,b){c.legends.push({color:k.colors[b],title:M(a.x)})}),("bar"===u||"area"===u||"point"===u||"line"===u&&"traditional"===k.lineLegend)&&angular.forEach(o,function(a,b){c.legends.push({color:k.colors[b],title:M(a)})})}function L(a){return String(a).replace(/[&<>"'\/]/g,function(a){return K[a]})}function M(a){return f.trustAsHtml(k.legend.htmlEnabled?a:L(a))}function N(a){if(a<k.colors.length)return k.colors[a];var b=h();return k.colors.push(b),b}var k={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:[],innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0},l=g[0].clientWidth,m=g[0].clientHeight;if(0===m||0===l)throw new Error("Please set height and width for the chart element");var n,o,p,q,r,s,t,u,K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},O=angular.element(d),P=null;O.bind("resize",function(a){P&&e.cancel(P),P=e(function(){l=g[0].clientWidth,m=g[0].clientHeight,v()},100)}),c.getWindowDimensions=function(){return{h:O[0].clientHeight,w:O[0].clientWidth}},c.$watch("[acChart, acData, acConfig]",v,!0),c.$watch(function(){return{w:g[0].clientWidth,h:g[0].clientHeight}},function(a){l=a.w,m=a.h,v()},!0)}return{restrict:"EA",link:j,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),function(){var a=".angular-charts-template .axis path,.angular-charts-template .axis line{fill:none;stroke:#333}.angular-charts-template .ac-title{font-weight:700;font-size:1.2em}.angular-charts-template .ac-chart{float:left;width:75%}.angular-charts-template .ac-line{fill:none;stroke-width:2px}.angular-charts-template table{float:left;max-width:25%;list-style:none;margin:0;padding:0}.angular-charts-template td[ng-bind]{display:inline-block}.angular-charts-template .ac-legend-box{border-radius:5px;height:15px;width:15px}.ac-tooltip{display:block;position:absolute;border:2px solid rgba(51,51,51,.9);background-color:rgba(22,22,22,.7);border-radius:5px;padding:5px;color:#fff}",b=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet)b.styleSheet.disabled||(b.styleSheet.cssText=a);else try{b.innerHTML=a}catch(c){b.innerText=a}}(),angular.module("angularChartsTemplates",["angularChartsTemplate_left","angularChartsTemplate_right"]),angular.module("angularChartsTemplate_left",[]).run(["$templateCache",function(a){a.put("angularChartsTemplate_left",'<div class="angular-charts-template"><div class="ac-title">{{acConfig.title}}</div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div><div class="ac-chart"></div></div>')}]),angular.module("angularChartsTemplate_right",[]).run(["$templateCache",function(a){a.put("angularChartsTemplate_right",'<div class="angular-charts-template"><div class="ac-title">{{acConfig.title}}</div><div class="ac-chart"></div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends | limitTo:yMaxData"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div></div>')}]);